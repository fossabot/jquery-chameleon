/**
 * 
 *   _____ _    _          __  __ ______ _      ______ ____  _   _ 
 *  / ____| |  | |   /\   |  \/  |  ____| |    |  ____/ __ \| \ | |
 * | |    | |__| |  /  \  | \  / | |__  | |    | |__ | |  | |  \| |
 * | |    |  __  | / /\ \ | |\/| |  __| | |    |  __|| |  | | . ` |
 * | |____| |  | |/ ____ \| |  | | |____| |____| |___| |__| | |\  |
 *  \_____|_|  |_/_/    \_\_|  |_|______|______|______\____/|_| \_|
 *                                                                 
 *                                                                 
 * chameleon.js - synchronizing slides with JWPlayer Video
 * @author Wing Kam Wong - wingkwong.code@gmail.com
 * @version - 1.1.0
 */

!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){var n="chameleon";function t(t,o){e(t);o=e.extend({},e.fn[n].defaults,o);var i=e(".chameleon"),d=e(this),a='<div class="video-container"></div>',l='<div class="slide-container"><img/></div>',s='<div class="info-panel"></div>',r='<div class="carousel-container"></div>',c='<div class="download-container"></div>',h='<div class="preview-slide-container"></div>',f='<div class="carousel-item"></div>',m='<div class="thumbnail-container"><div class="slide-image"><img/></div><div class="slide-number"></div></div>',p='<a class="carousel-control prev"></a><a class="carousel-control next"></a>',u='<span class="download-icon"></span>',v={base:'<div id="jwplayer" class="chameleon-jwplayer-video"></div>'},w={base:'<video id="chameleon-html5-video" class="chameleon-html5-video" controls preload="auto" width="100%" height="100%"/>',source:"<source/>"},x={base:'<div id="chameleon-youtube-video" class="chameleon-youtube-video" width="100%" height="100%" frameborder="0" allowfullscreen></div>'},C={base:'<div class="dropdown-box"></div>',header:'<div class="dropdown-header"></div>',button:'<div class="dropdown-btn-wrapper">Markers <span class="dropdown-btn down"></span></div>',content:'<div class="dropdown-content"></div>'},g={base:'<a href="javascript:;" class="info-panel-slide"></a>',slideNumber:'<div class="slide-number"></div>',slideTitle:'<div class="slide-title-wrapper"><div class="slide-title"></div></div>',slideTime:'<div class="slide-time"></div>'};function b(){if(void 0===d.chameleonContext.jwplayerSetup)throw new Error("jwplayer setup object hasn't been defined in chameleonContext.");if(void 0===d.chameleonContext.slides||"object"!=typeof d.chameleonContext.slides)throw new Error("slides hasn't been defined in chameleonContext.");if(0==d.chameleonContext.slides.length)throw new Error("No slide hasn't been defined in chameleonContext.");!function(){(function(){switch(o.player){case"jwplayer":i.find(".video-container").append(v.base),d.jwPlayerInst=jwplayer("jwplayer").setup(d.chameleonContext.jwplayerSetup),d.jwPlayerInst.onReady(function(){i.find(".video-container"),i.find(".slide-container img")}),d.jwPlayerInst.onTime(function(){var e=d.jwPlayerInst.getPosition();$(e)}),d.jwPlayerInst.onComplete(function(){I(0),j(0)});break;case"html5":i.find(".video-container").append(w.base),function(){var n=d.chameleonContext.html5Setup,t=i.find(".chameleon-html5-video");if("object"==typeof n.sources)$html5Source=e(w.source),$html5Source.attr({src:n.sources.file,type:n.sources.type}),t.append($html5Source);else if("array"==typeof n.sources)for(var o=0;o<n.sources.length;o++)$html5Source=e(w.source),$html5Source.attr({src:n.sources[o].file,type:n.sources[o].type}),t.append($html5Source);null!=n.poster&&""!=n.poster&&t.attr("poster",n.poster);t.bind("timeupdate",function(){var n=e(this).get(0).currentTime;$(n)}),t.bind("ended",function(){I(0),j(0)})}();break;case"youtube":i.find(".video-container").append(x.base),function(){i.find(".chameleon-youtube-video");var e=d.chameleonContext.youtubeSetup;d.ytPlayer=new YT.Player("chameleon-youtube-video",{height:"100%",width:"100%",videoId:e.videoId,events:{onReady:function(){setInterval(function(){$(d.ytPlayer.getCurrentTime())},1e3)}}})}();break;default:throw new Error(o.player+" is not supported")}})(),I(0),i.find(".carousel-container").append(h).append(p);for(var n=1;n<=d.chameleonContext.slides.length;n++){var t=e(f).append(m);t.find(".slide-image").attr("data-index",n),t.find(".slide-image img").attr("src",d.chameleonContext.slides[n-1].img),t.find(".slide-image img").attr("title",d.chameleonContext.slides[n-1].title),t.find(".slide-image img").attr("alt",d.chameleonContext.slides[n-1].alt),t.find(".slide-number").html(n+"/"+d.chameleonContext.slides.length),i.find(".preview-slide-container").append(t)}if(i.find(".carousel-item:first").addClass("active"),d.chameleonContext.slides.length>o.numOfCarouselSlide){i.find(".carousel-item").each(function(){for(var n=e(this),t=1;t<o.numOfCarouselSlide;t++)(n=n.next()).length||(n=e(this).siblings(":first")),n.children(":first-child").clone().addClass("js-chameleon-"+t).appendTo(e(this))});var a=i.find(".carousel-item.active").width(),l=i.find(".carousel-item.active .thumbnail-container:first").width();if(d.maxImgInARow=Math.floor(a/l),o.numOfCarouselSlide>d.maxImgInARow&&d.maxImgInARow>5)i.find(".carousel-item .js-chameleon-3").addClass("current-slide");else{var r=i.find(".carousel-item.active .thumbnail-container").length;if(Math.floor(r/2)>=1){var n=i.find(".carousel-item.active .thumbnail-container:nth-child( "+Math.floor(r/2)+") .slide-image").attr("data-index");i.find(".carousel-item .js-chameleon-"+n).addClass("current-slide")}else i.find(".carousel-control").remove(),i.find(".carousel-item .thumbnail-container").addClass("current-slide")}i.find(".current-slide img").css("width","120px"),j(0)}else i.find(".carousel-control").remove(),i.find(".carousel-item").addClass("active");e.isEmptyObject(d.chameleonContext.download)||(void 0===d.chameleonContext.download.slides&&void 0===d.chameleonContext.download.videos&&void 0===d.chameleonContext.download.transcript&&i.find(".download-container").remove(),void 0!==d.chameleonContext.download.slides&&"object"==typeof d.chameleonContext.download.slides&&(void 0!==d.chameleonContext.download.slides.url&&"string"==typeof d.chameleonContext.download.slides.url&&(i.find(".download-container").append('<a class="download-btn download-slides" target="_blank" download>Download slides</a>'),i.find(".download-slides").attr("href",d.chameleonContext.download.slides.url)),i.find(".download-slides").length>0&&void 0!==d.chameleonContext.download.slides.title&&"string"==typeof d.chameleonContext.download.slides.title&&(i.find(".download-slides").html(d.chameleonContext.download.slides.title),i.find(".download-slides").prepend(u),i.find(".download-slides").attr("title",d.chameleonContext.download.slides.title))),void 0!==d.chameleonContext.download.video&&"object"==typeof d.chameleonContext.download.video&&(void 0!==d.chameleonContext.download.video.url&&"string"==typeof d.chameleonContext.download.video.url&&(i.find(".download-container").append('<a class="download-btn download-video" target="_blank" download>Download video</a>'),i.find(".download-video").attr("href",d.chameleonContext.download.video.url)),i.find(".download-video").length>0&&void 0!==d.chameleonContext.download.video.title&&"string"==typeof d.chameleonContext.download.video.title&&(i.find(".download-video").html(d.chameleonContext.download.video.title),i.find(".download-video").prepend(u),i.find(".download-video").attr("title",d.chameleonContext.download.video.title))),void 0!==d.chameleonContext.download.transcript&&"object"==typeof d.chameleonContext.download.transcript&&(void 0!==d.chameleonContext.download.transcript.url&&"string"==typeof d.chameleonContext.download.transcript.url&&(i.find(".download-container").append('<a class="download-btn download-transcript" target="_blank" download>Download transcript</a>'),i.find(".download-transcript").attr("href",d.chameleonContext.download.transcript.url)),i.find(".download-transcript").length>0&&void 0!==d.chameleonContext.download.transcript.title&&"string"==typeof d.chameleonContext.download.transcript.title&&(i.find(".download-transcript").html(d.chameleonContext.download.transcript.title),i.find(".download-transcript").prepend(u),i.find(".download-transcript").attr("title",d.chameleonContext.download.transcript.title))));s=i.find(".info-panel"),$infoPanel=e(C.base),$header=e(C.header).append(C.button),$content=e(C.content),$ip=$infoPanel.append($header).append($content),s.append($ip);for(var n=0;n<d.chameleonContext.slides.length;n++)$infoPanelSlide=e(g.base).append(g.slideNumber).append(g.slideTime).append(g.slideTitle),$infoPanelSlide.attr("data-index",n),$infoPanelSlide.find(".slide-number").html("#"+(n+1)),$infoPanelSlide.find(".slide-time").html(d.chameleonContext.slides[n].time),void 0===d.chameleonContext.slides[n].title||""==d.chameleonContext.slides[n].title?$infoPanelSlide.find(".slide-title").html("-"):$infoPanelSlide.find(".slide-title").html(d.chameleonContext.slides[n].title),i.find(".dropdown-content").append($infoPanelSlide);i.find(".slide-image").click(function(){var n=e(this).attr("data-index");y(S(d.chameleonContext.slides[n-1].time))}),i.find(".carousel-control.prev").click(function(){var n=e(".active .current-slide .slide-image").attr("data-index");0==(n=parseInt(n)-1)&&(n=d.chameleonContext.slides.length),y(S(d.chameleonContext.slides[n-1].time))}),i.find(".carousel-control.next").click(function(){var e=i.find(".active .current-slide .slide-image").attr("data-index");e==d.chameleonContext.slides.length&&(e=0),y(S(d.chameleonContext.slides[e].time))}),i.find(".info-panel-slide").click(function(){var n=e(this),t=n.attr("data-index");y(S(d.chameleonContext.slides[t].time))}),i.find(".info-panel .dropdown-btn-wrapper").click(function(){var n=e(this).find(".dropdown-btn");n.hasClass("down")?(n.parent().parent().parent().find(".dropdown-content").slideDown(),n.removeClass("down").addClass("up")):(n.parent().parent().parent().find(".dropdown-content").slideUp(),n.removeClass("up").addClass("down"))}),o.responsive?(i.find(".video-container").addClass("col-md-6 col-xs-12"),i.find(".video-container").css({padding:"0px",height:"300px"}),i.find(".slide-container").addClass("col-md-6 col-xs-12"),i.find(".slide-container img").css({"margin-left":"auto","margin-right":"auto",padding:"0px"}),i.find(".info-panel").addClass("col-xs-12"),i.find(".carousel-container").addClass("col-xs-12 hidden-xs"),i.find(".download-container").addClass("col-xs-12"),i.find(".download-btn").addClass("col-xs-12 col-sm-4"),i.find(".download-btn").css({margin:"10px 0px"}),i.find(".info-panel-slide .slide-number").addClass("col-xs-12 col-sm-2"),i.find(".info-panel-slide .slide-time").addClass("col-xs-12 col-sm-2"),i.find(".info-panel-slide .slide-title-wrapper").addClass("col-xs-12 col-sm-8")):(i.find(".video-container").css({float:"left",width:"50%",height:"100%"}),i.find(".slide-container").css({width:"50%",height:"100%",float:"left"}),i.find(".download-container").css({width:"100%",height:"40px",float:"left","line-height":"40px"}),i.find(".download-btn").css({width:"30%"}),i.find(".info-panel .slide-number, .info-panel .slide-time").css({width:"8.33333333%",float:"left","text-align":"center"}),i.find(".info-panel .slide-title-wrapper").css({width:"83.33333333%",float:"left","text-align":"center"}),i.find(".info-panel .slide-title").css({"padding-left":"30px"}))}()}function y(e){switch(o.player){case"jwplayer":d.jwPlayerInst.seek(e);break;case"html5":var n=i.find(".chameleon-html5-video").get(0);n.currentTime=e,n.play();break;case"youtube":d.ytPlayer.seekTo(e);break;default:throw new Error(o.player+" is not supported")}}function j(n){n=parseInt(n)+1;var t=e('.current-slide .slide-image[data-index="'+n+'"]').parent().parent();e(".carousel-item.active").removeClass("active"),t.addClass("active")}function S(e){var n=e.split(":");return parseInt(60*n[0]*60)+parseInt(60*n[1])+parseInt(n[2])}function $(e){if(e>=S(d.chameleonContext.slides[d.chameleonContext.slides.length-1].time))d.chameleonContext.slides.length>o.numOfCarouselSlide&&j(d.chameleonContext.slides.length-1),I(d.chameleonContext.slides.length-1),P(d.chameleonContext.slides.length-1);else for(var n=0,t=1;n<d.chameleonContext.slides.length;n++,t++)e>=S(d.chameleonContext.slides[n].time)&&e<S(d.chameleonContext.slides[t].time)&&(d.chameleonContext.slides.length>o.numOfCarouselSlide&&(j(n),P(n)),I(n))}function I(e){i.find(".slide-container img").attr("src",d.chameleonContext.slides[e].img),i.find(".slide-container img").attr("title",d.chameleonContext.slides[e].title),i.find(".slide-container img").attr("alt",d.chameleonContext.slides[e].alt)}function P(e){i.find(".chameleon-hightlighted").removeClass("chameleon-hightlighted"),i.find(".info-panel-slide[data-index='"+e+"']").addClass("chameleon-hightlighted")}!function(){if(e.isEmptyObject(o.chameleonContext))throw new Error("Chameleon chameleonContext hasn't been defined.");if(i.append(a),i.append(l),i.append(s),i.append(r),i.append(c),o.responsive||i.css("width",o.width).css("height",o.height),"object"==typeof o.chameleonContext&&(d.chameleonContext=o.chameleonContext,b()),"string"==typeof o.chameleonContext){if("json"!=/(?:\.([^.]+))?$/.exec(o.chameleonContext)[1])throw new Error("JSON file required.");e.getJSON(o.chameleonContext,function(e){d.chameleonContext=e}).done(function(){b()})}}()}e.fn[n]=function(o){if("string"==typeof arguments[0]){var i,d=arguments[0],a=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!e.data(this,"plugin_"+n)||"function"!=typeof e.data(this,"plugin_"+n)[d])throw new Error("Method "+d+" does not exist on jQuery."+n);i=e.data(this,"plugin_"+n)[d].apply(this,a)}),void 0!==i?i:this}if("object"==typeof o||!o)return this.each(function(){e.data(this,"plugin_"+n)||e.data(this,"plugin_"+n,new t(this,o))})},e.fn[n].defaults={width:"968px",height:"300px",chameleonContext:{},numOfCarouselSlide:5,responsive:!1,player:"html5"}});