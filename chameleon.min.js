/**
 * 
 *   _____ _    _          __  __ ______ _      ______ ____  _   _ 
 *  / ____| |  | |   /\   |  \/  |  ____| |    |  ____/ __ \| \ | |
 * | |    | |__| |  /  \  | \  / | |__  | |    | |__ | |  | |  \| |
 * | |    |  __  | / /\ \ | |\/| |  __| | |    |  __|| |  | | . ` |
 * | |____| |  | |/ ____ \| |  | | |____| |____| |___| |__| | |\  |
 *  \_____|_|  |_/_/    \_\_|  |_|______|______|______\____/|_| \_|
 *                                                                 
 *                                                                 
 * chameleon.js - synchronizing slides with JWPlayer Video
 * @author Wing Kam Wong - wingkwong.code@gmail.com
 * @version - 1.0.0
 */

!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){var t="chameleon";function n(n,o){e(n);o=e.extend({},e.fn[t].defaults,o);var i=e(".chameleon"),a=e(this),l='<div class="video-container"><div id="jwplayer"></div></div>',d='<div class="slide-container"><img/></div>',s='<div class="download-container"></div>',r='<div class="carousel-container"></div>',c='<div class="preview-slide-container"></div>',h='<div class="carousel-item"></div>',m='<div class="thumbnail-container"><div class="slide-image"><img/></div><div class="slide-number"></div></div>',f='<a class="carousel-control prev">&lt;</a><a class="carousel-control next">&gt;</a>';function p(){if(void 0===a.chameleonContext.jwplayerKey)throw new Error("jwplayer key hasn't been defined in chameleonContext.");if(void 0===a.chameleonContext.jwplayerSetup)throw new Error("jwplayer setup object hasn't been defined in chameleonContext.");if(void 0===a.chameleonContext.slides||"object"!=typeof a.chameleonContext.slides)throw new Error("slides hasn't been defined in chameleonContext.");if(0==a.chameleonContext.slides.length)throw new Error("No slide hasn't been defined in chameleonContext.");!function(){jwplayer.key=a.chameleonContext.jwplayerKey,a.jwPlayerInst=jwplayer("jwplayer").setup(a.chameleonContext.jwplayerSetup),a.jwPlayerInst.onReady(function(){i.find(".video-container #jwplayer").css("width","100%").css("height","100%");var e=i.find(".video-container"),t=i.find(".slide-container img");e.height()>t.height()?t.css("padding-top",(e.height()-t.height())/2):(e.css("height",t.height()),e.css("padding-top",(t.height()-e.height())/2))}),a.jwPlayerInst.onTime(function(){var e=a.jwPlayerInst.getPosition();a.jwPlayerInst.getDuration(),function(e,t){if(e>=u(a.chameleonContext.slides[a.chameleonContext.slides.length-1].time))a.chameleonContext.slides.length>o.numOfCarouselSlide&&w(a.chameleonContext.slides.length-1),x(a.chameleonContext.slides.length-1);else for(var n=0,i=1;n<a.chameleonContext.slides.length;n++,i++)e>=u(a.chameleonContext.slides[n].time)&&e<u(a.chameleonContext.slides[i].time)&&(a.chameleonContext.slides.length>o.numOfCarouselSlide&&w(n),x(n))}(e)}),a.jwPlayerInst.onComplete(function(){x(0),w(0)}),x(0),i.find(".carousel-container").append(c).append(f);for(var t=1;t<=a.chameleonContext.slides.length;t++){var n=e(h).append(m);n.find(".slide-image").attr("data-index",t),n.find(".slide-image img").attr("src",a.chameleonContext.slides[t-1].img),n.find(".slide-image img").attr("title",a.chameleonContext.slides[t-1].title),n.find(".slide-image img").attr("alt",a.chameleonContext.slides[t-1].alt),n.find(".slide-number").html(t+"/"+a.chameleonContext.slides.length),i.find(".preview-slide-container").append(n)}if(i.find(".carousel-item:first").addClass("active"),a.chameleonContext.slides.length>o.numOfCarouselSlide){i.find(".carousel-item").each(function(){for(var t=e(this),n=1;n<o.numOfCarouselSlide;n++)(t=t.next()).length||(t=e(this).siblings(":first")),t.children(":first-child").clone().addClass("js-chameleon-"+n).appendTo(e(this))});var l=i.find(".carousel-item.active").width(),d=i.find(".carousel-item.active .thumbnail-container:first").width();if(a.maxImgInARow=Math.floor(l/d),o.numOfCarouselSlide>a.maxImgInARow&&a.maxImgInARow>5)i.find(".carousel-item .js-chameleon-3").addClass("current-slide");else{var s=i.find(".carousel-item.active .thumbnail-container").length;if(Math.floor(s/2)>=1){var t=i.find(".carousel-item.active .thumbnail-container:nth-child( "+Math.floor(s/2)+") .slide-image").attr("data-index");i.find(".carousel-item .js-chameleon-"+t).addClass("current-slide")}else i.find(".carousel-control").remove(),i.find(".carousel-item .thumbnail-container").addClass("current-slide")}i.find(".current-slide img").css("width","120px"),w(0)}else i.find(".carousel-control").remove(),i.find(".carousel-item").addClass("active");e.isEmptyObject(a.chameleonContext.download)||(void 0===a.chameleonContext.download.slides&&void 0===a.chameleonContext.download.videos&&void 0===a.chameleonContext.download.transcript&&i.find(".download-container").remove(),void 0!==a.chameleonContext.download.slides&&"object"==typeof a.chameleonContext.download.slides&&(void 0!==a.chameleonContext.download.slides.url&&"string"==typeof a.chameleonContext.download.slides.url&&(i.find(".download-container").append('<a class="download-btn download-slides" target="_blank">Download slides</a>'),i.find(".download-slides").attr("href",a.chameleonContext.download.slides.url)),i.find(".download-slides").length>0&&void 0!==a.chameleonContext.download.slides.title&&"string"==typeof a.chameleonContext.download.slides.title&&(i.find(".download-slides").html(a.chameleonContext.download.slides.title),i.find(".download-slides").attr("title",a.chameleonContext.download.slides.title))),void 0!==a.chameleonContext.download.video&&"object"==typeof a.chameleonContext.download.video&&(void 0!==a.chameleonContext.download.video.url&&"string"==typeof a.chameleonContext.download.video.url&&(i.find(".download-container").append('<a class="download-btn download-video" target="_blank">Download video</a>'),i.find(".download-video").attr("href",a.chameleonContext.download.video.url)),i.find(".download-video").length>0&&void 0!==a.chameleonContext.download.video.title&&"string"==typeof a.chameleonContext.download.video.title&&(i.find(".download-video").html(a.chameleonContext.download.video.title),i.find(".download-video").attr("title",a.chameleonContext.download.video.title))),void 0!==a.chameleonContext.download.transcript&&"object"==typeof a.chameleonContext.download.transcript&&(void 0!==a.chameleonContext.download.transcript.url&&"string"==typeof a.chameleonContext.download.transcript.url&&(i.find(".download-container").append('<a class="download-btn download-transcript" target="_blank">Download transcript</a>'),i.find(".download-transcript").attr("href",a.chameleonContext.download.transcript.url)),i.find(".download-transcript").length>0&&void 0!==a.chameleonContext.download.transcript.title&&"string"==typeof a.chameleonContext.download.transcript.title&&(i.find(".download-transcript").html(a.chameleonContext.download.transcript.title),i.find(".download-transcript").attr("title",a.chameleonContext.download.transcript.title))));i.find(".slide-image").click(function(){var t=e(this).attr("data-index");a.jwPlayerInst.seek(u(a.chameleonContext.slides[t-1].time))}),i.find(".carousel-control.prev").click(function(){var t=e(".active .current-slide .slide-image").attr("data-index");0==(t=parseInt(t)-1)&&(t=a.chameleonContext.slides.length),a.jwPlayerInst.seek(u(a.chameleonContext.slides[t-1].time))}),i.find(".carousel-control.next").click(function(){var e=i.find(".active .current-slide .slide-image").attr("data-index");e==a.chameleonContext.slides.length&&(e=0),a.jwPlayerInst.seek(u(a.chameleonContext.slides[e].time))})}()}function w(t){t=parseInt(t)+1;var n=e('.current-slide .slide-image[data-index="'+t+'"]').parent().parent();e(".carousel-item.active").removeClass("active"),n.addClass("active")}function u(e){var t=e.split(":");return parseInt(60*t[0]*60)+parseInt(60*t[1])+parseInt(t[2])}function x(e){i.find(".slide-container img").attr("src",a.chameleonContext.slides[e].img),i.find(".slide-container img").attr("title",a.chameleonContext.slides[e].title),i.find(".slide-container img").attr("alt",a.chameleonContext.slides[e].alt)}!function(){if(e.isEmptyObject(o.chameleonContext))throw new Error("Chameleon chameleonContext hasn't been defined.");if(i.append(l).append(d).append(s).append(r),i.css("width",o.width).css("height",o.height),"object"==typeof o.chameleonContext&&(a.chameleonContext=o.chameleonContext,p()),"string"==typeof o.chameleonContext){if("json"!=/(?:\.([^.]+))?$/.exec(o.chameleonContext)[1])throw new Error("JSON file required.");e.getJSON(o.chameleonContext,function(e){a.chameleonContext=e}).done(function(){p()})}}()}e.fn[t]=function(o){if("string"==typeof arguments[0]){var i,a=arguments[0],l=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!e.data(this,"plugin_"+t)||"function"!=typeof e.data(this,"plugin_"+t)[a])throw new Error("Method "+a+" does not exist on jQuery."+t);i=e.data(this,"plugin_"+t)[a].apply(this,l)}),void 0!==i?i:this}if("object"==typeof o||!o)return this.each(function(){e.data(this,"plugin_"+t)||e.data(this,"plugin_"+t,new n(this,o))})},e.fn[t].defaults={width:"968px",height:"300px",chameleonContext:{},numOfCarouselSlide:5}});